import{r as c,g as w,s as R,d as B,t as O,j as n,a as D,e as T,b as I}from"../chunks/extension-D_8lOYWw.js";import{g as S,a as U,s as W}from"../chunks/auth-E5V3AkTb.js";function M(l,{filter:a,tagFilter:r,searchQuery:o}){let t=l;if(a==="favourites"?t=t.filter(s=>s.is_favorite):a!=="all"&&(t=t.filter(s=>(s.category||"Other")===a)),r&&(t=t.filter(s=>(s.tags||[]).includes(r))),o!=null&&o.trim()){const s=o.toLowerCase();t=t.filter(d=>{var f,p,h,m;return((f=d.title)==null?void 0:f.toLowerCase().includes(s))||((p=d.url)==null?void 0:p.toLowerCase().includes(s))||((h=d.category)==null?void 0:h.toLowerCase().includes(s))||((m=d.ai_summary)==null?void 0:m.toLowerCase().includes(s))||(d.tags||[]).some(y=>y.toLowerCase().includes(s))})}return t}function A(l,a){const r=[...l];switch(a){case"newest":r.sort((o,t)=>new Date(t.created_at)-new Date(o.created_at));break;case"oldest":r.sort((o,t)=>new Date(o.created_at)-new Date(t.created_at));break;case"title-az":r.sort((o,t)=>(o.title||"").localeCompare(t.title||""));break;case"title-za":r.sort((o,t)=>(t.title||"").localeCompare(o.title||""));break;case"most-visited":r.sort((o,t)=>(t.click_count||0)-(o.click_count||0));break;case"least-visited":r.sort((o,t)=>(o.click_count||0)-(t.click_count||0));break}return r.sort((o,t)=>(t.is_pinned?1:0)-(o.is_pinned?1:0)),r}function F(l){const a={};return l.forEach(r=>{const o=r.category||"Other";a[o]=(a[o]||0)+1}),Object.entries(a).sort((r,o)=>o[1]-r[1])}function H(l){const a={};return l.forEach(r=>{(r.tags||[]).forEach(o=>{a[o]=(a[o]||0)+1})}),Object.entries(a).sort((r,o)=>o[1]-r[1])}function P(l){const a={app:"LinkNest",exportedAt:new Date().toISOString(),count:l.length,bookmarks:l.map(s=>({title:s.title,url:s.url,category:s.category||null,tags:s.tags||[],ai_summary:s.ai_summary||null,is_favorite:!!s.is_favorite,is_pinned:!!s.is_pinned,click_count:s.click_count||0,created_at:s.created_at}))},r=new Blob([JSON.stringify(a,null,2)],{type:"application/json"}),o=URL.createObjectURL(r),t=document.createElement("a");t.href=o,t.download=`linknest-bookmarks-${new Date().toISOString().slice(0,10)}.json`,document.body.appendChild(t),t.click(),document.body.removeChild(t),URL.revokeObjectURL(o)}function $(){var v;const[l,a]=c.useState(null),[r,o]=c.useState(!0),[t,s]=c.useState([]),[d,f]=c.useState("all"),[p,h]=c.useState(""),[m,y]=c.useState(null),[x,_]=c.useState("newest");c.useRef(null),c.useEffect(()=>{(async()=>{const{user:e}=await S();if(a(e),o(!1),e){const{data:i}=await w(e.id);s(i||[])}})()},[]),c.useEffect(()=>l?R(l.id,i=>{i.eventType==="INSERT"?s(u=>u.some(g=>g.id===i.new.id)?u:[i.new,...u]):i.eventType==="DELETE"?s(u=>u.filter(g=>g.id!==i.old.id)):i.eventType==="UPDATE"&&s(u=>u.map(g=>g.id===i.new.id?i.new:g))}):void 0,[l]);const C=c.useMemo(()=>F(t),[t]);c.useMemo(()=>H(t),[t]);const b=c.useMemo(()=>M(t,{filter:d,tagFilter:m,searchQuery:p}),[t,d,m,p]),j=c.useMemo(()=>A(b,x),[b,x]),z=c.useCallback(async e=>{s(i=>i.filter(u=>u.id!==e)),await B(e)},[]),E=c.useCallback(async(e,i)=>{const u=!i;s(g=>g.map(k=>k.id===e?{...k,is_favorite:u}:k)),await O(e,u)},[]),N=c.useCallback(()=>{t.length!==0&&P(t)},[t]),L=async()=>{try{await W("google");const{user:e}=await S();if(a(e),e){const{data:i}=await w(e.id);s(i||[])}}catch(e){console.error("Sign in error:",e)}};return r?n.jsx("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"100vh",background:"#050505",color:"#71717a"},children:"Loading..."}):l?n.jsxs("div",{style:{maxWidth:720,margin:"0 auto",padding:24,minHeight:"100vh",background:"#050505"},children:[n.jsxs("div",{className:"header",style:{marginBottom:24},children:[n.jsxs("div",{className:"header-left",children:[n.jsx("span",{className:"logo",style:{fontSize:24},children:"ðŸ”–"}),n.jsx("h1",{style:{fontSize:20},children:"LinkNest"})]}),n.jsxs("div",{className:"header-right",children:[n.jsx("span",{style:{color:"#71717a",fontSize:12},children:((v=l.user_metadata)==null?void 0:v.full_name)||l.email}),n.jsx("button",{className:"btn-text",onClick:()=>{U(),a(null)},children:"Sign out"})]})]}),n.jsxs("div",{style:{display:"flex",gap:12,marginBottom:16},children:[n.jsx("input",{type:"text",placeholder:"Search bookmarks...",value:p,onChange:e=>h(e.target.value),style:{flex:1,padding:"10px 14px",borderRadius:12,border:"1px solid rgba(255,255,255,0.06)",background:"rgba(255,255,255,0.03)",color:"#e4e4e7",fontSize:14,outline:"none"}}),n.jsxs("select",{value:x,onChange:e=>_(e.target.value),style:{padding:"10px 14px",borderRadius:12,border:"1px solid rgba(255,255,255,0.06)",background:"rgba(255,255,255,0.03)",color:"#a1a1aa",fontSize:13,outline:"none",cursor:"pointer"},children:[n.jsx("option",{value:"newest",children:"Newest"}),n.jsx("option",{value:"oldest",children:"Oldest"}),n.jsx("option",{value:"title-az",children:"A â†’ Z"}),n.jsx("option",{value:"most-visited",children:"Most visited"})]})]}),n.jsxs("div",{style:{display:"flex",flexWrap:"wrap",gap:6,marginBottom:16},children:[n.jsxs("button",{onClick:()=>f("all"),className:`btn-text ${d==="all"?"active-filter":""}`,style:{padding:"6px 14px",borderRadius:10,fontSize:13,fontWeight:500,background:d==="all"?"linear-gradient(to right, #e8590c, #f97316)":"rgba(255,255,255,0.03)",color:d==="all"?"white":"#71717a",border:d==="all"?"none":"1px solid rgba(255,255,255,0.06)"},children:["All (",t.length,")"]}),C.map(([e,i])=>n.jsxs("button",{onClick:()=>f(e),className:"btn-text",style:{padding:"4px 10px",borderRadius:8,fontSize:11,background:d===e?"linear-gradient(to right, #e8590c, #f97316)":"rgba(255,255,255,0.03)",color:d===e?"white":"#71717a",border:d===e?"none":"1px solid rgba(255,255,255,0.06)"},children:[e," (",i,")"]},e))]}),n.jsx("div",{style:{marginBottom:16},children:n.jsx("button",{className:"btn-text",onClick:N,style:{fontSize:12,color:"#f97316"},children:"ðŸ“¤ Export all"})}),j.length===0?n.jsxs("div",{style:{textAlign:"center",padding:48,color:"#71717a"},children:[n.jsx("span",{style:{fontSize:32,opacity:.4},children:"ðŸ“­"}),n.jsx("p",{style:{marginTop:8,fontSize:13},children:"No bookmarks found"})]}):n.jsx("ul",{style:{listStyle:"none",display:"flex",flexDirection:"column",gap:6},children:j.map(e=>n.jsxs("li",{style:{display:"flex",alignItems:"center",gap:10,padding:"10px 14px",borderRadius:14,border:`1px solid ${e.is_pinned?"rgba(245,158,11,0.2)":"rgba(255,255,255,0.06)"}`,background:e.is_pinned?"rgba(245,158,11,0.04)":"rgba(255,255,255,0.02)",cursor:"pointer",transition:"background 0.2s"},onClick:()=>{T(e.id),window.open(e.url,"_blank")},children:[n.jsx("img",{src:D(e.url)||"",alt:"",style:{width:18,height:18,borderRadius:3,flexShrink:0},onError:i=>i.target.style.display="none"}),n.jsxs("div",{style:{flex:1,minWidth:0},children:[n.jsxs("p",{style:{fontSize:13,fontWeight:500,color:"#e4e4e7",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:[e.is_pinned&&"ðŸ“Œ ",e.title]}),n.jsx("p",{style:{fontSize:11,color:"#71717a",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:e.url})]}),e.category&&n.jsx("span",{className:"category-badge",children:e.category}),n.jsx("button",{onClick:i=>{i.stopPropagation(),E(e.id,e.is_favorite)},style:{background:"none",border:"none",cursor:"pointer",fontSize:14,color:e.is_favorite?"#fbbf24":"#52525b"},children:e.is_favorite?"â˜…":"â˜†"}),n.jsx("button",{onClick:i=>{i.stopPropagation(),z(e.id)},style:{background:"none",border:"none",cursor:"pointer",fontSize:12,color:"#52525b"},children:"âœ•"})]},e.id))})]}):n.jsxs("div",{style:{display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",minHeight:"100vh",background:"#050505",gap:16},children:[n.jsx("span",{style:{fontSize:48},children:"ðŸ”–"}),n.jsx("h1",{style:{color:"#e4e4e7",fontSize:24,fontWeight:700},children:"LinkNest"}),n.jsx("p",{style:{color:"#71717a",fontSize:14},children:"Sign in to manage your bookmarks"}),n.jsx("button",{className:"btn-primary",onClick:L,style:{maxWidth:260},children:"Sign in with Google"})]})}I.createRoot(document.getElementById("root")).render(n.jsx($,{}));
